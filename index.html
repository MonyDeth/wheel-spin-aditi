<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customizable Spinning Prize Wheel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        .animate-pulse-zoom {
            animation: pulse-zoom 2s infinite;
        }
        @keyframes pulse-zoom {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
        .wheel-container {
            position: relative;
            width: 650px;
            height: 650px;
        }
        @media (max-width: 768px) {
            .wheel-container {
                width: 650px;
                height: 650px;
            }
        }
        .pointer {
            width: 0;
            height: 0;
            border-top: 15px solid transparent;
            border-bottom: 15px solid transparent;
            border-left: 25px solid #B41F3A; /* Points right, gets flipped to point left */
        }
        #ad-image-container {
            position: relative;
            width: 100%;
            padding-top: 100%; /* 1:1 Aspect Ratio */
        }
        #ad-image-container img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0.75rem; /* rounded-xl */
            transition: opacity 0.5s ease-in-out;
        }
        .transition-layout {
            transition: width 0.6s ease, opacity 0.6s ease; }
        .wheel-full          { width: 100% !important; }
        .ad-hidden           { width:   0   !important; opacity: 0 !important; pointer-events: none; }

    </style>
</head>
<body class="bg-gray-100 overflow-hidden">

<div id="app-container" class="relative flex flex-col items-center min-h-screen justify-center px-4 overflow-hidden">

    <div class="flex flex-col md:flex-row items-center justify-center gap-8 w-full max-h-screen overflow-hidden">


    <!-- Logo doubled as ‚ÄúCustomize‚Äù button -->
    <img src="Images/ADITI-Academy.png"
         id="open-settings-btn"
         class="absolute top-4 left-4 z-30 cursor-pointer  h-16 hover:scale-105 transition-transform duration-300"
         alt="Customize">

    <!-- Wheel + Ad layout -->
    <div class="flex flex-col md:flex-row items-center min-h-screen justify-center gap-8 m-b w-full p-4">

        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Wheel (unchanged) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <div class="left-container transition-layout flex w-full md:w-1/2 justify-center items-center relative">
            <div class="flex-shrink-0 relative flex items-center justify-center">
                <div class="wheel-container">
                    <canvas id="wheel-canvas" width="650" height="650"></canvas>

                    <button id="spin-btn"
                            class="absolute inset-0 m-auto w-24 h-24 bg-white rounded-full border-8 border-gray-200 text-gray-800 font-bold text-xl shadow-2xl animate-pulse-zoom flex items-center justify-center text-center transition-transform duration-200 disabled:opacity-50 disabled:animate-none">
                        SPIN
                    </button>
                </div>
                <div class="absolute left-full top-1/2 -translate-y-1/2 -ml-3 z-10 pointer rotate-180"></div>

            </div>

            <!-- Pointer on the right edge of the wheel -->
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Advertisement banner (unchanged) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <div class="right-container transition-layout flex w-full md:w-1/2 justify-center items-center p-4" id="ad-banner">
            <div id="ad-image-container" class="w-[500px] h-[500px] flex items-center justify-center">
                <!-- Ad images will be injected here -->
            </div>
        </div>
    </div>
</div>


<!-- Prize Modal -->
<div id="prize-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
    <div
            class="bg-white rounded-2xl shadow-2xl p-8 text-center max-w-lg w-full mx-4 transform transition-all scale-95 opacity-0">
        <h2 class="text-2xl font-bold text-gray-800 mb-2">Congratulations!</h2>

        <p class="text-gray-600 mb-4">You've won:</p>

<!--        <img id="won-prize-image" src="" alt="Prize Image"-->
<!--             class="w-40 h-40 object-cover mx-auto mb-4 rounded-lg block" />-->

        <p id="prize-result" class="text-4xl font-bold text-[#B41F3A] mb-6"></p>

<!--        <div id="prize-banner-container" class="mb-6 hidden">-->
<!--            <img id="prize-banner-img" src="" alt="Prize Banner" class="max-w-full h-auto rounded-lg mx-auto" />-->
<!--        </div>-->

        <button id="close-prize-modal"
                class="bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-red-700 transition-transform hover:scale-105">
            Awesome!
        </button>
    </div>
</div>


<!-- Settings Modal -->
<div id="settings-modal" class="fixed h-90 inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
    <div class="bg-gray-200 rounded-2xl shadow-2xl p-4 md:p-6 w-full max-w-5xl mx-4 transform transition-all scale-95 opacity-0 h-[550px] flex flex-col md:flex-row overflow-hidden">

        <!-- Left Tabs -->
        <nav class="flex md:flex-col w-full m-4 md:w-1/4 space-x-4 md:space-x-0 md:space-y-2 overflow-x-auto md:overflow-visible flex-shrink-0 mb-4 md:mb-0 pr-2 md:pr-0">
            <h2 class="text-2xl font-bold text-gray-800">Configuration</h2>
            <button data-tab="prizes" class="tab-btn text-left px-4 py-3 bg-blue-100 text-blue-700 rounded-lg font-semibold">üéÅ Prizes</button>
            <button data-tab="appearance" class="tab-btn text-left px-4 py-3 text-gray-600 hover:bg-gray-100 rounded-lg">üé® Appearance</button>
            <button data-tab="background" class="tab-btn text-left px-4 py-3 text-gray-600 hover:bg-gray-100 rounded-lg">üåÑ Background</button>
            <button data-tab="prize-banner" class="tab-btn text-left px-4 py-3 text-gray-600 hover:bg-gray-100 rounded-lg">üèÜ Prize Banner</button>
            <button data-tab="ad-banner" class="tab-btn text-left px-4 py-3 text-gray-600 hover:bg-gray-100 rounded-lg">üì¢ Banner</button>
        </nav>



        <!-- Right Content -->
        <div class="flex-1 overflow-y-auto pl-0 md:pl-6 p-4 bg-white rounded-xl">
            <div class="flex justify-end items-center mb-4 sticky top-0 bg-white z-10">
                <button id="close-settings-modal" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>

            <div id="tab-content" class="space-y-10">
                <!-- Prizes Tab -->
                <div id="prizes-tab" class="tab-pane">
                    <h3 class="font-semibold text-lg mb-4">Manage Prizes</h3>
                    <div id="prize-list" class="space-y-3 mb-4 max-h-64 overflow-y-auto pr-2"></div>

                    <div class="mt-4 border-t pt-4 space-y-2">
                        <p class="text-sm text-gray-500">You need at least 2 prizes to spin the wheel.</p>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 items-center">
                            <input type="text" id="new-prize-name-input" placeholder="Prize Name"
                                   class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <input type="text" id="new-prize-image-input" placeholder="Image URL (optional)"
                                   class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <button id="add-prize-btn"
                                    class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 w-full sm:w-auto">
                                Add
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Appearance Tab -->
                <div id="appearance-tab" class="tab-pane hidden">
                    <h3 class="font-semibold text-lg mb-4">Appearance</h3>
                    <div class="flex flex-wrap items-center gap-4">
                        <div>
                            <label for="color1" class="block text-sm font-medium text-gray-700 mb-1">Primary Color</label>
                            <input type="color" id="color1" value="#3b82f6"
                                   class="block rounded-lg border border-gray-300 w-10 h-10 p-0">
                        </div>
                        <div>
                            <label for="color2" class="block text-sm font-medium text-gray-700 mb-1">Secondary Color</label>
                            <input type="color" id="color2" value="#ffffff"
                                   class="block rounded-lg border border-gray-300 w-10 h-10 p-0">
                        </div>
<!--                        <div class="flex items-center gap-2 ml-auto">-->
<!--                            <label for="spin-duration" class="text-sm font-medium text-gray-700 whitespace-nowrap">Spin Time (seconds)</label>-->
<!--                            <input type="number" id="spin-duration" min="3" max="15" value="8"-->
<!--                                   class="w-16 p-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">-->
<!--                        </div>-->
                    </div>

                    <h3 class="font-semibold text-lg mb-4 mt-6">Manage Logos</h3>
                    <div id="logo-list"
                         class="space-y-2 max-h-40 overflow-y-auto border border-gray-200 bg-gray-50 rounded-lg p-2">
                        <!-- Logos go here -->
                    </div>

                    <p class="text-sm text-gray-500 mt-4">Upload your logos here.</p>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 mt-2 items-center">
                        <input type="text" id="new-logo-name-input" placeholder="Logo Name"
                               class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <input type="text" id="new-logo-url-input" placeholder="Logo URL"
                               class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <button id="add-logo-btn"
                                class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 w-full sm:w-auto">
                            Add
                        </button>
                    </div>
                </div>

                <!-- Background Tab -->
                <div id="background-tab" class="tab-pane hidden">
                    <h3 class="font-semibold text-lg mb-4">Page Background</h3>
                    <p class="text-sm text-gray-600 mb-2">Enter an image URL to set as the background.</p>
                    <div class="flex gap-2">
                        <input type="text" id="bg-image-url" placeholder="https://example.com/image.jpg"
                               class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <button id="set-bg-btn"
                                class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">Set</button>
                    </div>
                    <!-- Background Image Preview -->
                    <div id="bg-image-preview"
                         class="mt-4 rounded-lg border border-gray-300">
                        <img id="bg-image-preview-img" src="" alt="Background Preview"
                             class="w-full h-48 object-cover rounded-lg" />
                    </div>
                    <button id="remove-bg-btn" class="mt-2 text-sm text-red-500 hover:underline">Remove Background</button>
                </div>

                <!-- Prize Banner Tab -->
                <div id="prize-banner-tab" class="tab-pane hidden">
                    <h3 class="font-semibold text-lg mb-4">Prize Won Banner</h3>
                    <p class="text-sm text-gray-600 mb-2">Enter an image URL to show in the popup when a prize is won.</p>
                    <div class="flex gap-2">
                        <input type="text" id="prize-banner-image-url" placeholder="https://example.com/banner.jpg"
                               class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <button id="set-prize-banner-btn"
                                class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">Set</button>
                    </div>
                    <!-- Prize Banner Image Preview -->
                    <div id="prize-banner-image-preview"
                         class="mt-4 rounded-lg border border-gray-300">
                        <img id="prize-banner-preview-img" src="" alt="Prize Banner Preview"
                             class="w-full h-48 object-cover rounded-lg" />
                    </div>
                    <button id="remove-prize-banner-btn" class="mt-2 text-sm text-red-500 hover:underline">Remove Banner</button>
                </div>

                <!-- Ad Banner Tab -->
                <div id="ad-banner-tab" class="tab-pane hidden">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-lg">Manage Banner Images</h3>
                        <div class="flex items-center gap-3">
                            <div class="flex items-center gap-2 text-sm">
                                <label for="ad-flip-interval" class="text-gray-700">Interval (s):</label>
                                <input type="number" id="ad-flip-interval" min="1" max="15" value="5"
                                       class="w-16 p-1 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                            </div>
                            <button id="save-ad-settings-btn"
                                    class="bg-blue-600 text-white font-bold py-1.5 px-4 rounded-lg hover:bg-blue-700 text-sm whitespace-nowrap">
                                Save
                            </button>
                        </div>
                    </div>

                    <div id="ad-list" class="space-y-3 mb-4 max-h-64 overflow-y-auto pr-2"></div>

                    <p class="text-sm text-gray-500">Add banner ads to rotate on the screen.</p>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 mt-2 items-center">
                        <input type="text" id="new-ad-name-input" placeholder="Ad Name"
                               class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <input type="text" id="new-ad-url-input" placeholder="Image URL"
                               class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <button id="add-ad-btn"
                                class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 w-full sm:w-auto">
                            Add
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded',  () => {
        // --- Elements ---
        const canvas = document.getElementById('wheel-canvas');
        const ctx = canvas.getContext('2d');
        const spinBtn = document.getElementById('spin-btn');
        const adBanner = document.getElementById('ad-banner');
        const adImageContainer = document.getElementById('ad-image-container');
        const prizeModal = document.getElementById('prize-modal');
        const settingsModal = document.getElementById('settings-modal');
        const prizeResult = document.getElementById('prize-result');
        const wonPrizeImage = document.getElementById('won-prize-image');
        const closePrizeModalBtn = document.getElementById('close-prize-modal');
        const openSettingsBtn = document.getElementById('open-settings-btn');
        const closeSettingsModalBtn = document.getElementById('close-settings-modal');
        const prizeListContainer = document.getElementById('prize-list');
        const newPrizeNameInput = document.getElementById('new-prize-name-input');
        const newPrizeImageInput = document.getElementById('new-prize-image-input');
        const addPrizeBtn = document.getElementById('add-prize-btn');
        const color1Input = document.getElementById('color1');
        const color2Input = document.getElementById('color2');
        const spinDurationInput = document.getElementById('spin-duration');
        const spinDurationValue = document.getElementById('spin-duration-value');
        const bgImageUrlInput = document.getElementById('bg-image-url');
        const setBgBtn = document.getElementById('set-bg-btn');
        const removeBgBtn = document.getElementById('remove-bg-btn');
        const prizeBannerUrlInput = document.getElementById('prize-banner-image-url');
        const setPrizeBannerBtn = document.getElementById('set-prize-banner-btn');
        const removePrizeBannerBtn = document.getElementById('remove-prize-banner-btn');
        const prizeBannerContainer = document.getElementById('prize-banner-container');
        const prizeBannerImg = document.getElementById('prize-banner-img');
        const adBannerUrlsInput = document.getElementById('ad-banner-urls');
        const adFlipIntervalInput = document.getElementById('ad-flip-interval');
        const adFlipIntervalValue = document.getElementById('ad-flip-interval-value');
        const saveAdSettingsBtn = document.getElementById('save-ad-settings-btn');
        const leftContainer  = document.querySelector('.left-container');
        const rightContainer = document.querySelector('.right-container');
        const adListContainer = document.getElementById('ad-list');
        const logoListEl = document.getElementById('logo-list');
        const newLogoNameInput = document.getElementById('new-logo-name-input');
        const newLogoUrlInput = document.getElementById('new-logo-url-input');
        const addLogoBtn = document.getElementById('add-logo-btn');

        //customization
        let prizes = [];
        let prizeBannerUrl = '';
        let adBannerUrls = [];
        let colors = [];
        let logos = []; // Array of {name, url}
        let selectedLogoIndex = 0; // Index of active logo

        fetch('./Preload/preload.json')
            .then(res => res.json())
            .then(data => {
                prizes = data.prizes;
                prizeBannerUrl = data.prizeBannerUrl;
                backgroundUrl = data.backgroundUrl || '';

                adBannerUrls = Array.isArray(data.ads)
                    ? data.ads.map(ad => ({ name: ad.name || '', url: ad.url?.trim() || '' })).filter(ad => ad.url)
                    : data.ads.split('\n').map(url => ({ name: '', url: url.trim() })).filter(ad => ad.url);

                colors = data.colors;
                logos = data.logo || [];

                // Initialize UI and visuals
                updatePrizeList();
                drawWheel();
                updateAdImage();
                startAdCarousel();
                updateAdList();
                applyBackgroundImage();

                updateLogoList();
                updateSelectedLogo();
            })
            .catch(err => {
                console.error("Error loading preload.json", err);
                updatePrizeList();
                drawWheel();
                updateAdImage();
                startAdCarousel();
            });


        function applyBackgroundImage() {
            const container = document.getElementById('app-container'); // or whichever container should get background
            if (backgroundUrl) {
                container.style.backgroundImage = `url('${backgroundUrl}')`;
                container.style.backgroundSize = 'cover';
                container.style.backgroundPosition = 'center';
            } else {
                container.style.backgroundImage = '';
            }
        }

        document.getElementById("remove-bg-btn").addEventListener("click", () => {
            backgroundUrl = '';
            document.getElementById("bg-image-url").value = "";
            applyBackgroundImage();
        });



        let spinDuration;
        const minSpinDuration = 5;  // seconds
        const maxSpinDuration = 12; // seconds

        let spinAngle = 0;
        let isSpinning = false;
        let animationFrameId;
        let adFlipInterval = 10000;
        let currentAdIndex = 0;
        let adCarouselIntervalId;

        // --- Helpers ---
        const getContrastColor = (hexColor) => {
            if (hexColor.startsWith('#')) {
                hexColor = hexColor.slice(1);
            }
            const r = parseInt(hexColor.substr(0, 2), 16);
            const g = parseInt(hexColor.substr(2, 2), 16);
            const b = parseInt(hexColor.substr(4, 2), 16);
            const yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;
            return (yiq >= 128) ? '#000000' : '#FFFFFF';
        };

        // --- Wheel ---
        const drawWheel = () => {
            if (prizes.length === 0) return;
            const radius = canvas.width / 2;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(radius, radius);
            ctx.rotate(spinAngle);

            let startAngle = 0;

            for (let i = 0; i < prizes.length; i++) {
                const prize = prizes[i];
                const arcSize = (prize.percentage / 100) * 2 * Math.PI;
                const bgColor = colors[i % 2];

                ctx.beginPath();
                ctx.fillStyle = bgColor;
                ctx.moveTo(0, 0);
                ctx.arc(0, 0, radius - 5, startAngle, startAngle + arcSize);
                ctx.closePath();
                ctx.fill();

                ctx.save();
                ctx.fillStyle = getContrastColor(bgColor);
                ctx.font = 'bold 16px Poppins';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.rotate(startAngle + arcSize / 2);
                ctx.fillText(prize.name, radius * 0.65, 0);
                ctx.restore();

                startAngle += arcSize;
            }

            ctx.restore();
        };


        // --- Spin ---
        const easeOut = t => 1 - Math.pow(1 - t, 4);
        let startTime = null, startAngle = 0, endAngle = 0;

        const animateSpin = (timestamp) => {
            if (!startTime) startTime = timestamp;
            const progress = Math.min((timestamp - startTime) / (spinDuration * 1000), 1);
            spinAngle = startAngle + (endAngle - startAngle) * easeOut(progress);
            drawWheel();
            if (progress < 1) animationFrameId = requestAnimationFrame(animateSpin);
            else stopSpinning();
        };

        const spin = () => {
            if (isSpinning) return;
            isSpinning = true;

            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }

            leftContainer.classList.add('wheel-full');
            rightContainer.classList.add('ad-hidden');

            spinBtn.disabled = true;
            startTime = null;
            startAngle = spinAngle % (2 * Math.PI);

            // Randomize spin duration each time
            spinDuration = minSpinDuration + Math.random() * (maxSpinDuration - minSpinDuration);

            if (adBanner.style.opacity !== '0') {
                adBanner.style.opacity = '0';
                if (adCarouselIntervalId) clearInterval(adCarouselIntervalId);
            }

            const randomSpins = 5 + Math.random() * 5;
            endAngle = startAngle + (randomSpins * 2 * Math.PI) + (Math.random() * 2 * Math.PI);

            animationFrameId = requestAnimationFrame(animateSpin);
        };

        const stopSpinning = () => {
            isSpinning = false;
            spinBtn.disabled = false;
            cancelAnimationFrame(animationFrameId);

            // Calculate angle at pointer (assuming pointer at 12 o'clock)
            const finalAngle = (2 * Math.PI - (spinAngle % (2 * Math.PI))) % (2 * Math.PI);

            let cumulativeAngle = 0;
            let winningIndex = 0;

            for (let i = 0; i < prizes.length; i++) {
                const arcSize = (prizes[i].percentage / 100) * 2 * Math.PI;
                if (finalAngle >= cumulativeAngle && finalAngle < cumulativeAngle + arcSize) {
                    winningIndex = i;
                    break;
                }
                cumulativeAngle += arcSize;
            }

            setTimeout(() => showPrizeModal(prizes[winningIndex]), 500);
        };

        // logo
        function updateLogoList() {
            logoListEl.innerHTML = '';
            logos.forEach((logo, index) => {
                const isSelected = index === selectedLogoIndex;

                const logoItem = document.createElement('div');
                logoItem.className = "flex items-center gap-3 p-1 rounded hover:bg-gray-200 cursor-pointer bg-gray-10 ps-3";

                // Radio button
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = 'selected-logo';
                radio.checked = isSelected;
                radio.id = `logo-radio-${index}`;
                radio.className = 'accent-blue-600';
                radio.style.transform = 'scale(1.5)';
                radio.addEventListener('change', () => {
                    selectedLogoIndex = index;
                    updateSelectedLogo();
                    updateLogoList(); // re-render to reflect new selection
                });

                // Logo thumbnail
                const img = document.createElement('img');
                img.src = logo.url;
                img.alt = logo.name;
                img.className = "w-12 h-12 object-contain border border-gray-300 rounded bg-gray-200";

                // Logo label
                const label = document.createElement('label');
                label.htmlFor = radio.id;
                label.textContent = logo.name;
                label.className = "cursor-pointer";

                // Combine elements
                logoItem.appendChild(radio);
                logoItem.appendChild(img);
                logoItem.appendChild(label);
                logoListEl.appendChild(logoItem);
            });
        }

        function updateSelectedLogo() {
            if (logos[selectedLogoIndex]) {
                openSettingsBtn.src = logos[selectedLogoIndex].url;
                // You could also save selectedLogoIndex to localStorage or backend here
            }
        }

// Add new logo handler
        addLogoBtn.addEventListener('click', () => {
            const name = newLogoNameInput.value.trim();
            const url = newLogoUrlInput.value.trim();
            if (!name || !url) {
                alert('Please provide both name and URL for the logo.');
                return;
            }
            logos.push({ name, url });
            selectedLogoIndex = logos.length - 1; // select new logo by default
            updateLogoList();
            updateSelectedLogo();

            // Clear inputs
            newLogoNameInput.value = '';
            newLogoUrlInput.value = '';
        });

        // --- Ad Banner ---
        const updateAdImage = () => {
            if (adBannerUrls.length === 0) {
                adImageContainer.innerHTML = '';
                return;
            }

            const ad = adBannerUrls[currentAdIndex];
            const newImage = document.createElement('img');
            newImage.src = ad.url;
            newImage.alt = ad.name || 'Ad Image';
            newImage.onerror = () => newImage.src = 'https://placehold.co/300x300/fecaca/991b1b?text=Image+Error';
            newImage.style.opacity = '0';

            const oldImage = adImageContainer.querySelector('img');
            adImageContainer.appendChild(newImage);

            setTimeout(() => newImage.style.opacity = '1', 10);
            if (oldImage) {
                oldImage.style.opacity = '0';
                setTimeout(() => oldImage.remove(), 500);
            }
        };
        const updateAdList = () => {
            adListContainer.innerHTML = '';
            adBannerUrls.forEach((ad, index) => {
                const adEl = document.createElement('div');
                adEl.className = 'p-2 bg-gray-100 rounded-lg flex items-center gap-3';

                // Create thumbnail image element
                const thumbnail = document.createElement('img');
                thumbnail.src = ad.url;
                thumbnail.alt = ad.name || 'Ad Thumbnail';
                thumbnail.onerror = () => thumbnail.src = 'https://placehold.co/40x40/f0f0f0/999999?text=No+Image';
                thumbnail.style.width = '40px';
                thumbnail.style.height = '40px';
                thumbnail.style.objectFit = 'cover';
                thumbnail.style.borderRadius = '6px';
                thumbnail.style.flexShrink = '0';

                // Create content container
                const content = document.createElement('div');
                content.className = 'flex-grow';

                content.innerHTML = `
            <div class="flex justify-between items-center">
                <span class="font-semibold">${ad.name || 'Unnamed Ad'}</span>
                <button data-index="${index}" class="remove-ad-btn text-red-500 hover:text-red-700 text-xl">&times;</button>
            </div>
            <p class="text-xs text-gray-500 truncate mt-1 max-w-[250px] block">${ad.url}</p>
        `;

                adEl.appendChild(thumbnail);
                adEl.appendChild(content);
                adListContainer.appendChild(adEl);
            });
        };


        document.getElementById('add-ad-btn').addEventListener('click', () => {
            const name = document.getElementById('new-ad-name-input').value.trim();
            const url = document.getElementById('new-ad-url-input').value.trim();
            if (url) {
                adBannerUrls.push({ name, url });
                document.getElementById('new-ad-name-input').value = '';
                document.getElementById('new-ad-url-input').value = '';
                updateAdList();
            }
        });
        document.getElementById('set-bg-btn').addEventListener('click', () => {
            const url = document.getElementById('bg-image-url').value.trim();
            if (url) {
                backgroundUrl = url;
                applyBackgroundImage();
                // Optionally, show preview or confirmation
                alert('Background updated!');
            } else {
                alert('Please enter a valid background image URL.');
            }
        });

        adListContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('remove-ad-btn')) {
                const index = parseInt(e.target.dataset.index, 10);
                adBannerUrls.splice(index, 1);
                updateAdList();
            }
        });
        document.getElementById('ad-flip-interval').addEventListener('input', e => {
            document.getElementById('ad-flip-interval-value').textContent = e.target.value;
        });

        document.querySelectorAll('.tab-btn').forEach(button => {
            button.addEventListener('click', () => {
                const tab = button.getAttribute('data-tab');

                // Toggle active button styling
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('bg-blue-100', 'text-blue-700');
                    btn.classList.add('text-gray-600');
                });
                button.classList.add('bg-blue-100', 'text-blue-700');
                button.classList.remove('text-gray-600');

                // Show the selected tab pane
                document.querySelectorAll('.tab-pane').forEach(pane => {
                    pane.classList.add('hidden');
                });
                document.getElementById(`${tab}-tab`).classList.remove('hidden');
            });
        });

        function setupImagePreview(inputId, previewContainerId) {
            const input = document.getElementById(inputId);
            const previewContainer = document.getElementById(previewContainerId);
            const previewImg = previewContainer.querySelector('img');

            input.addEventListener('input', () => {
                const url = input.value.trim();
                if (url) {
                    previewImg.src = url;
                    previewContainer.classList.remove('hidden');
                } else {
                    previewImg.src = '';
                    previewContainer.classList.add('hidden');
                }
            });
        }



        const startAdCarousel = () => {
            if (adCarouselIntervalId) clearInterval(adCarouselIntervalId);
            if (adBannerUrls.length > 1) {
                adCarouselIntervalId = setInterval(() => {
                    currentAdIndex = (currentAdIndex + 1) % adBannerUrls.length;
                    updateAdImage();
                }, adFlipInterval);
            }
        };

        // --- Modals ---
        // const showPrizeModal = (prize) => {
        //     prizeResult.textContent = prize.name;
        //     if (prize.image) {
        //         wonPrizeImage.src = prize.image;
        //         wonPrizeImage.classList.remove('hidden');
        //     } else {
        //         wonPrizeImage.classList.add('hidden');
        //     }
        //     if (prizeBannerUrl) {
        //         prizeBannerImg.src = prizeBannerUrl;
        //         prizeBannerContainer.classList.remove('hidden');
        //     } else {
        //         prizeBannerContainer.classList.add('hidden');
        //     }
        //     prizeModal.classList.remove('hidden');
        //     setTimeout(() => prizeModal.querySelector('div').classList.remove('scale-95', 'opacity-0'), 10);
        //     confetti({ particleCount: 150, spread: 180, origin: { y: 0.6 } });
        // };

        const showPrizeModal = (prize) => {
            prizeResult.textContent = prize.name;

            // Remove image logic since images are gone from HTML
            // if (prize.image) { ... }
            // if (prizeBannerUrl) { ... }

            prizeModal.classList.remove('hidden');
            setTimeout(() => prizeModal.querySelector('div').classList.remove('scale-95', 'opacity-0'), 10);

            confetti({ particleCount: 500, spread: 200, origin: { y: 0.6 } });
        };



        closePrizeModalBtn.addEventListener('click', () => {
            // Animate and hide the prize modal
            prizeModal.querySelector('div').classList.add('scale-95', 'opacity-0');
            setTimeout(() => prizeModal.classList.add('hidden'), 300);

            // Reset layout back to 50/50
            leftContainer.classList.remove('wheel-full');
            rightContainer.classList.remove('ad-hidden');

            // Show ad banner and restart carousel
            adBanner.style.display = 'flex';
            setTimeout(() => {
                adBanner.style.opacity = '1';
                startAdCarousel();
            }, 10);
        });


        const showSettingsModal = () => {
            settingsModal.classList.remove('hidden');
            setTimeout(() => settingsModal.querySelector('div').classList.remove('scale-95', 'opacity-0'), 10);
        };

        const hideSettingsModal = () => {
            settingsModal.querySelector('div').classList.add('scale-95', 'opacity-0');
            setTimeout(() => settingsModal.classList.add('hidden'), 300);
        };

        // --- Settings ---
        const updatePrizeList = () => {
            prizeListContainer.innerHTML = '';
            prizes.forEach((prize, index) => {
                const prizeEl = document.createElement('div');
                prizeEl.className = 'p-2 bg-gray-100 rounded-lg flex items-center gap-3';

                // Thumbnail image
                const thumbnail = document.createElement('img');
                thumbnail.src = prize.image || '';
                thumbnail.alt = prize.name || 'Prize Thumbnail';
                thumbnail.onerror = () => thumbnail.src = 'https://placehold.co/40x40/f0f0f0/999999?text=No+Image';
                thumbnail.style.width = '40px';
                thumbnail.style.height = '40px';
                thumbnail.style.objectFit = 'cover';
                thumbnail.style.borderRadius = '6px';
                thumbnail.style.flexShrink = '0';

                // Content container
                const content = document.createElement('div');
                content.className = 'flex-grow';

                content.innerHTML = `
            <div class="flex justify-between items-center">
                <span class="font-semibold">${prize.name}</span>
                <button data-index="${index}" class="remove-prize-btn text-red-500 hover:text-red-700 text-xl">&times;</button>
            </div>
            <p class="text-xs text-gray-500 truncate mt-1 max-w-[250px] block"">${prize.image || 'No image'}</p>
        `;

                prizeEl.appendChild(thumbnail);
                prizeEl.appendChild(content);
                prizeListContainer.appendChild(prizeEl);
            });
            drawWheel();
        };


        prizeListContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('remove-prize-btn')) {
                const index = parseInt(e.target.dataset.index, 10);
                if (prizes.length > 2) {
                    prizes.splice(index, 1);
                    updatePrizeList();
                } else {
                    alert('You must have at least 2 prizes.');
                }
            }
        });


        document.getElementById("remove-bg-btn").addEventListener("click", () => {
            document.getElementById("bg-image-url").value = "";
            document.getElementById("bg-image-preview-img").src = "";
        });

        // Prize Banner
        document.getElementById("set-prize-banner-btn").addEventListener("click", () => {
            const url = document.getElementById("prize-banner-image-url").value.trim();
            const img = document.getElementById("prize-banner-preview-img");

            if (url) {
                prizeBannerUrl = url;
                img.src = url;
                img.classList.remove('hidden');
                document.getElementById("prize-banner-preview-container").classList.remove('hidden');
            } else {
                alert("Please enter a valid image URL for the prize banner.");
            }
        });


        document.getElementById("remove-prize-banner-btn").addEventListener("click", () => {
            prizeBannerUrl = '';
            document.getElementById("prize-banner-image-url").value = '';
            document.getElementById("prize-banner-preview-img").src = '';
            document.getElementById("prize-banner-preview-container").classList.add('hidden');
        });


        const addPrize = () => {
            const name = newPrizeNameInput.value.trim();
            const image = newPrizeImageInput.value.trim();
            if (name) {
                prizes.push({ name, image });
                newPrizeNameInput.value = '';
                newPrizeImageInput.value = '';
                updatePrizeList();
            }
        };

        // --- Event Listeners ---
        spinBtn.addEventListener('click', spin);
        openSettingsBtn.addEventListener('click', showSettingsModal);
        closeSettingsModalBtn.addEventListener('click', hideSettingsModal);
        addPrizeBtn.addEventListener('click', addPrize);
        color1Input.addEventListener('input', (e) => { colors[0] = e.target.value; drawWheel(); });
        color2Input.addEventListener('input', (e) => { colors[1] = e.target.value; drawWheel(); });
        spinDurationInput.addEventListener('input', (e) => { spinDuration = parseInt(e.target.value, 10); spinDurationValue.textContent = spinDuration; });
        setBgBtn.addEventListener('click', () => {
            const url = bgImageUrlInput.value.trim();
            if (url) { document.body.style.backgroundImage = `url(${url})`; document.body.style.backgroundSize = 'cover'; document.body.style.backgroundPosition = 'center'; }
        });
        removeBgBtn.addEventListener('click', () => { document.body.style.backgroundImage = ''; bgImageUrlInput.value = ''; });
        setPrizeBannerBtn.addEventListener('click', () => { prizeBannerUrl = prizeBannerUrlInput.value.trim(); alert('Prize banner URL set!'); });
        removePrizeBannerBtn.addEventListener('click', () => { prizeBannerUrl = ''; prizeBannerUrlInput.value = ''; alert('Prize banner removed.'); });

        adFlipIntervalInput.addEventListener('input', e => { adFlipIntervalValue.textContent = e.target.value; });
        saveAdSettingsBtn.addEventListener('click', () => {
            const urls = adBannerUrlsInput.value.split('\n').map(u => u.trim()).filter(u => u);
            adBannerUrls = urls.length > 0 ? urls : ['https://placehold.co/300x300/e2e8f0/334155?text=Your+Ad+Here'];
            adFlipInterval = parseInt(adFlipIntervalInput.value, 10) * 1000;
            currentAdIndex = 0;
            updateAdImage();
            startAdCarousel();
            alert('Ad banner settings saved!');
        });

        // --- Settings Tabs ---
        const tabs = document.getElementById('settings-tabs');
        tabs.addEventListener('click', (e) => {
            if (e.target.classList.contains('tab-btn')) {
                const targetTab = e.target.dataset.tab;
                tabs.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('border-blue-600', 'text-blue-600');
                    btn.classList.add('text-gray-500', 'border-transparent');
                });
                e.target.classList.add('border-blue-600', 'text-blue-600');
                e.target.classList.remove('text-gray-500', 'border-transparent');
                document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.toggle('hidden', pane.id !== `${targetTab}-tab`));
            }
        });

        // --- Initialization ---
        updatePrizeList();
        drawWheel();
        updateAdImage();
        startAdCarousel();
        updateLogoList();
        updateSelectedLogo();
        setupImagePreview('bg-image-url', 'bg-image-preview');
        setupImagePreview('prize-banner-image-url', 'prize-banner-image-preview');

    });


</script>
</body>
</html>
